<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filmify {% block title %} {% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/4b8a91679a.js" crossorigin="anonymous"></script>

  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"
    integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2"
    crossorigin="anonymous"></script>




</head>

<body>
  <!--
// v0 by Vercel.
// https://v0.dev/t/Rs1VPdp19N1
-->
  <input type="hidden" name="csrf_token" value="{{csrf_token()}}" />
  <div class="flex flex-col min-h-screen">
    <header class="bg-gray-900 text-white py-4 px-6 md:px-8">
      <div class="container mx-auto flex justify-between items-center">
        <a class="text-xl font-bold" href="{{ url_for('films' ) }}"><i class="fa-solid fa-film"></i> Filmify
        </a>
        <div class="flex items-center ">
          <div
            class="relative flex h-10 w-full border border-input px-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pl-10 pr-4 py-2 rounded-md bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-600">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 w-5 h-5">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.3-4.3"></path>
            </svg>
            <form id="searchForm" class="flex">
              <input class="bg-transparent focus:border-none focus:outline-none" placeholder="Search films..."
                type="text" name="search" id="search" />
              <button>

                Submit
              </button>
            </form>
          </div>

          <div id="serchResults" class="absolute space-x-0  top-16 z-10 ">

          </div>
        </div>

        <nav class="md:flex items-center space-x-6 hidden ">

          <a class="hover:text-gray-400" href="{{ url_for('films' ) }}">
            Movies
          </a>
          {% if session["admin"] %}
          <a class="hover:text-gray-400" href="{{ url_for('add_film' ) }}">
            Add
          </a>
          <a class="hover:text-gray-400" href="{{ url_for('users' ) }}">Users</a>
          {% endif %} {% if session["username"] %}
          <a class="hover:text-gray-400" href="{{ url_for('logout' ) }}">
            {{ session["username"] }}
          </a>
          {% endif %}
        </nav>

      </div>
    </header>

    <main class="flex-1 bg-gray-100 dark:bg-gray-900 py-8 px-4 md:px-8">
      {% block content %}{% endblock %}
    </main>

    <footer class="bg-gray-900 text-white py-4 px-6 md:px-8">
      <div class="container mx-auto flex justify-between items-center">
        <p>Â© 2023 Film Database. All rights reserved.</p>
        <nav class="hidden md:flex items-center space-x-6">
          <a class="hover:text-gray-400" href="#"></a>
        </nav>
      </div>
    </footer>
  </div>
</body>
{% block scripts %}{% endblock %}

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>

  function deleteFilm(film_id) {
    console.log(film_id);
    //rip off from this element  <input type="hidden" name="csrf_token" value="{{csrf_token()}}" /> csrf_token
    const csrf_token = "{{csrf_token()}}";
    console.log(csrf_token);
    fetch(`/delete/${film_id}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrf_token,
      },
      body: JSON.stringify({ csrf_token: csrf_token }),
    })
      .then(() => {
        window.location.reload();
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  }
  //search
  document.getElementById("search").addEventListener("input", async (e) => {


    const search = e.target.value;
    if (search.length < 3) {
      const searchResults = document.getElementById("serchResults");
      searchResults.innerHTML = "";
      return;
    }
    data = await fetch("/search?search=" + search)
      .then((response) => response.json())
      .then((data) => {
        console.log(data);
        return data;
      });

    const searchResults = document.getElementById("serchResults");
    searchResults.innerHTML = "";
    if (data.length === 0) {
      const div = document.createElement("div");
      div.classList.add("w-36");
      div.innerHTML = `<div class="relative flex h-10 w-full border border-input px-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  py-2 rounded-md bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-600">No results</div>`;
      searchResults.appendChild(div);
    }
    data.forEach((film) => {
      const div = document.createElement("div");

      div.classList.add("m-0");
      div.innerHTML = `<a class="relative flex h-10 w-full border border-input px-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  py-2 rounded-md bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-600" href="/film/${film.id}">${film.title}</a>`;
      searchResults.appendChild(div);
    });

  })

</script>

</html>